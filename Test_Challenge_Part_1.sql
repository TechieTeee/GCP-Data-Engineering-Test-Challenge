CREATE TEMP FUNCTION COMPUTE_BUCKET_INFO(min FLOAT64, max FLOAT64, quartiles ARRAY<FLOAT64>, maxBins INT64) RETURNS STRUCT<min FLOAT64, max FLOAT64, quartiles ARRAY<FLOAT64>, roundMin FLOAT64, roundMax FLOAT64, numBins FLOAT64, buckets ARRAY<FLOAT64>> LANGUAGE js OPTIONS ( library=["gs://dataprep-staging-42666461-a1a6-4c75-876e-19c764660b2f/student-02-cacb906211b4@qwiklabs.net/temp/udf-bundle/udfs.js"] ) AS r"""return computeBuckets(min,max,quartiles,maxBins);"""; CREATE TEMP FUNCTION FORMAT_NUMERICAL_PROFILE_RESULTS(min FLOAT64, max FLOAT64, quartiles ARRAY<FLOAT64>, roundMin FLOAT64, roundMax FLOAT64, numBins FLOAT64, buckets ARRAY<STRUCT<pos FLOAT64, b INT64>>) RETURNS STRUCT<min FLOAT64, max FLOAT64, buckets ARRAY<STRUCT<pos FLOAT64, b FLOAT64>>, roundMin FLOAT64, roundMax FLOAT64, quartiles STRUCT<q1 FLOAT64,  q2 FLOAT64, q3 FLOAT64>, numBins FLOAT64> LANGUAGE js OPTIONS ( library=["gs://dataprep-staging-42666461-a1a6-4c75-876e-19c764660b2f/student-02-cacb906211b4@qwiklabs.net/temp/udf-bundle/udfs.js"] ) AS r"""return formatNumericalProfile(min,max,quartiles,roundMin,roundMax,numBins,buckets);"""; CREATE TEMP FUNCTION FORMAT_CATEGORICAL_PROFILE_RESULTS(topK ARRAY<STRUCT<value STRING, count INT64>>, k INT64) RETURNS STRUCT<k FLOAT64, topk ARRAY<STRUCT<key STRING, count FLOAT64>>> LANGUAGE js OPTIONS ( library=["gs://dataprep-staging-42666461-a1a6-4c75-876e-19c764660b2f/student-02-cacb906211b4@qwiklabs.net/temp/udf-bundle/udfs.js"] ) AS r"""return formatCategoricalProfile(topK,k);"""; CREATE TEMP FUNCTION FORMAT_TYPE_CHECK_PROFILE_RESULTS(results ARRAY<STRUCT<key STRING, count NUMERIC>>) RETURNS ARRAY<STRUCT<key STRING, count FLOAT64>> LANGUAGE js OPTIONS ( library=["gs://dataprep-staging-42666461-a1a6-4c75-876e-19c764660b2f/student-02-cacb906211b4@qwiklabs.net/temp/udf-bundle/udfs.js"] ) AS r"""return formatTypeCheckProfile(results);""";
CREATE TEMP table TF_TEMP_TBL AS SELECT fullVisitorId AS fullVisitorId_temp_, channelGrouping AS channelGrouping_temp_, time AS time_temp_, country AS country_temp_, city AS city_temp_, totalTransactionRevenue AS totalTransactionRevenue_temp_, SAFE_DIVIDE(SAFE_CAST(totalTransactionRevenue AS FLOAT64), 1000000) AS `_f6_temp_`, transactions AS transactions_temp_, timeOnSite AS timeOnSite_temp_, pageviews AS pageviews_temp_, sessionQualityDim AS sessionQualityDim_temp_, date AS date_temp_, visitId AS visitId_temp_, `_f12` AS `_f12_temp_`, type AS type_temp_, productRefundAmount AS productRefundAmount_temp_, productQuantity AS productQuantity_temp_, productPrice AS productPrice_temp_, productRevenue AS productRevenue_temp_, productSKU AS productSKU_temp_, v2ProductName AS v2ProductName_temp_, v2ProductCategory AS v2ProductCategory_temp_, productVariant AS productVariant_temp_, currencyCode AS currencyCode_temp_, transactionRevenue AS transactionRevenue_temp_, transactionId AS transactionId_temp_, pageTitle AS pageTitle_temp_, searchKeyword AS searchKeyword_temp_, pagePathLevel1 AS pagePathLevel1_temp_, eCommerceAction_type AS eCommerceAction_type_temp_, `_f29` AS `_f29_temp_`, eCommerceAction_step AS eCommerceAction_step_temp_, eCommerceAction_option AS eCommerceAction_option_temp_
FROM (SELECT fullVisitorId, channelGrouping, time, country, city, totalTransactionRevenue, transactions, timeOnSite, pageviews, sessionQualityDim, date, visitId, `_f12`, type, productRefundAmount, productQuantity, productPrice, productRevenue, productSKU, v2ProductName, v2ProductCategory, productVariant, currencyCode, transactionRevenue, transactionId, pageTitle, searchKeyword, pagePathLevel1, eCommerceAction_type, (CASE WHEN (SAFE_CAST(eCommerceAction_type AS INT64) = 0) THEN 'Unknown' WHEN (SAFE_CAST(eCommerceAction_type AS INT64) = 1) THEN 'Click through of product lists' WHEN (SAFE_CAST(eCommerceAction_type AS INT64) = 2) THEN 'Product detail views' WHEN (SAFE_CAST(eCommerceAction_type AS INT64) = 3) THEN 'Add product(s) to cart' WHEN (SAFE_CAST(eCommerceAction_type AS INT64) = 4) THEN 'Remove product(s) from cart' WHEN (SAFE_CAST(eCommerceAction_type AS INT64) = 5) THEN 'Check out' WHEN (SAFE_CAST(eCommerceAction_type AS INT64) = 6) THEN 'Completed purchase' WHEN (SAFE_CAST(eCommerceAction_type AS INT64) = 7) THEN 'Refund of purchase' WHEN (SAFE_CAST(eCommerceAction_type AS INT64) = 8) THEN 'Checkout options' ELSE NULL END) AS `_f29`, eCommerceAction_step, eCommerceAction_option
  FROM (SELECT fullVisitorId, channelGrouping, time, country, city, totalTransactionRevenue, transactions, timeOnSite, pageviews, sessionQualityDim, date, visitId, IF(((COALESCE(IF(TRUE, CONCAT(IFNULL(fullVisitorId, ''), IFNULL('-', '')), NULL), CAST(visitId AS STRING))) IS NOT NULL), CONCAT(IFNULL(IF(TRUE, CONCAT(IFNULL(fullVisitorId, ''), IFNULL('-', '')), NULL), ''), IFNULL(CAST(visitId AS STRING), '')), NULL) AS `_f12`, type, productRefundAmount, productQuantity, productPrice, productRevenue, productSKU, v2ProductName, v2ProductCategory, productVariant, currencyCode, transactionRevenue, transactionId, pageTitle, searchKeyword, pagePathLevel1, eCommerceAction_type, eCommerceAction_step, eCommerceAction_option
    FROM (SELECT fullVisitorId, channelGrouping, time, country, city, totalTransactionRevenue, transactions, timeOnSite, pageviews, sessionQualityDim, date, visitId, type, productRefundAmount, productQuantity, productPrice, productRevenue, productSKU, v2ProductName, v2ProductCategory, productVariant, currencyCode, transactionRevenue, transactionId, pageTitle, searchKeyword, pagePathLevel1, eCommerceAction_type, eCommerceAction_step, eCommerceAction_option
      FROM `qwiklabs-gcp-01-ce890c4f7559`.ecommerce.all_sessions_raw_dataprep
      WHERE ((type = 'PAGE') AND (totalTransactionRevenue IS NOT NULL))
      GROUP BY all_sessions_raw_dataprep.fullVisitorId, all_sessions_raw_dataprep.channelGrouping, all_sessions_raw_dataprep.time, all_sessions_raw_dataprep.country, all_sessions_raw_dataprep.city, all_sessions_raw_dataprep.totalTransactionRevenue, all_sessions_raw_dataprep.transactions, all_sessions_raw_dataprep.timeOnSite, all_sessions_raw_dataprep.pageviews, all_sessions_raw_dataprep.sessionQualityDim, all_sessions_raw_dataprep.date, all_sessions_raw_dataprep.visitId, all_sessions_raw_dataprep.type, all_sessions_raw_dataprep.productRefundAmount, all_sessions_raw_dataprep.productQuantity, all_sessions_raw_dataprep.productPrice, all_sessions_raw_dataprep.productRevenue, all_sessions_raw_dataprep.productSKU, all_sessions_raw_dataprep.v2ProductName, all_sessions_raw_dataprep.v2ProductCategory, all_sessions_raw_dataprep.productVariant, all_sessions_raw_dataprep.currencyCode, all_sessions_raw_dataprep.transactionRevenue, all_sessions_raw_dataprep.transactionId, all_sessions_raw_dataprep.pageTitle, all_sessions_raw_dataprep.searchKeyword, all_sessions_raw_dataprep.pagePathLevel1, all_sessions_raw_dataprep.eCommerceAction_type, all_sessions_raw_dataprep.eCommerceAction_step, all_sessions_raw_dataprep.eCommerceAction_option) AS t1) AS t2) AS t3;
EXPORT DATA OPTIONS(
  uri='gs://dataprep-staging-42666461-a1a6-4c75-876e-19c764660b2f/student-02-cacb906211b4@qwiklabs.net/jobrun/all_sessions_raw_dataprep_17012301/.profiler_b98d3b8a-22d6-4a2d-b8be-6c9bbf3ca6a8/profilerValidValueHistograms.json/*',
  format='JSON',
  overwrite=true
) AS SELECT FORMAT_CATEGORICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f0`), 20) AS fullVisitorId, FORMAT_CATEGORICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f1`), 20) AS channelGrouping, FORMAT_NUMERICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f2`.min), ANY_VALUE(t4.`_f2`.max), ANY_VALUE(t4.`_f2`.quartiles), ANY_VALUE(t4.`_f2`.roundMin), ANY_VALUE(t4.`_f2`.roundMax), ANY_VALUE(t4.`_f2`.numBins), APPROX_TOP_COUNT(LEAST(GREATEST(0, SAFE_SUBTRACT(RANGE_BUCKET(t8.`_f2`, t4.`_f2`.buckets), 1)), SAFE_SUBTRACT(t4.`_f2`.numBins, 1)), 20)) AS time, FORMAT_CATEGORICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f5`), 20) AS country, FORMAT_CATEGORICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f6`), 20) AS city, FORMAT_NUMERICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f7`.min), ANY_VALUE(t4.`_f7`.max), ANY_VALUE(t4.`_f7`.quartiles), ANY_VALUE(t4.`_f7`.roundMin), ANY_VALUE(t4.`_f7`.roundMax), ANY_VALUE(t4.`_f7`.numBins), APPROX_TOP_COUNT(LEAST(GREATEST(0, SAFE_SUBTRACT(RANGE_BUCKET(t8.`_f5`, t4.`_f7`.buckets), 1)), SAFE_SUBTRACT(t4.`_f7`.numBins, 1)), 20)) AS totalTransactionRevenue, FORMAT_NUMERICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f8`.min), ANY_VALUE(t4.`_f8`.max), ANY_VALUE(t4.`_f8`.quartiles), ANY_VALUE(t4.`_f8`.roundMin), ANY_VALUE(t4.`_f8`.roundMax), ANY_VALUE(t4.`_f8`.numBins), APPROX_TOP_COUNT(LEAST(GREATEST(0, SAFE_SUBTRACT(RANGE_BUCKET(t8.`_f6`, t4.`_f8`.buckets), 1)), SAFE_SUBTRACT(t4.`_f8`.numBins, 1)), 20)) AS totalTransactionRevenue1, FORMAT_NUMERICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f9`.min), ANY_VALUE(t4.`_f9`.max), ANY_VALUE(t4.`_f9`.quartiles), ANY_VALUE(t4.`_f9`.roundMin), ANY_VALUE(t4.`_f9`.roundMax), ANY_VALUE(t4.`_f9`.numBins), APPROX_TOP_COUNT(LEAST(GREATEST(0, SAFE_SUBTRACT(RANGE_BUCKET(t8.`_f7`, t4.`_f9`.buckets), 1)), SAFE_SUBTRACT(t4.`_f9`.numBins, 1)), 20)) AS transactions, FORMAT_NUMERICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f10`.min), ANY_VALUE(t4.`_f10`.max), ANY_VALUE(t4.`_f10`.quartiles), ANY_VALUE(t4.`_f10`.roundMin), ANY_VALUE(t4.`_f10`.roundMax), ANY_VALUE(t4.`_f10`.numBins), APPROX_TOP_COUNT(LEAST(GREATEST(0, SAFE_SUBTRACT(RANGE_BUCKET(t8.`_f8`, t4.`_f10`.buckets), 1)), SAFE_SUBTRACT(t4.`_f10`.numBins, 1)), 20)) AS timeOnSite, FORMAT_NUMERICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f11`.min), ANY_VALUE(t4.`_f11`.max), ANY_VALUE(t4.`_f11`.quartiles), ANY_VALUE(t4.`_f11`.roundMin), ANY_VALUE(t4.`_f11`.roundMax), ANY_VALUE(t4.`_f11`.numBins), APPROX_TOP_COUNT(LEAST(GREATEST(0, SAFE_SUBTRACT(RANGE_BUCKET(t8.`_f9`, t4.`_f11`.buckets), 1)), SAFE_SUBTRACT(t4.`_f11`.numBins, 1)), 20)) AS pageviews, FORMAT_NUMERICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f12`.min), ANY_VALUE(t4.`_f12`.max), ANY_VALUE(t4.`_f12`.quartiles), ANY_VALUE(t4.`_f12`.roundMin), ANY_VALUE(t4.`_f12`.roundMax), ANY_VALUE(t4.`_f12`.numBins), APPROX_TOP_COUNT(LEAST(GREATEST(0, SAFE_SUBTRACT(RANGE_BUCKET(t8.`_f10`, t4.`_f12`.buckets), 1)), SAFE_SUBTRACT(t4.`_f12`.numBins, 1)), 20)) AS sessionQualityDim, FORMAT_NUMERICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f13`.min), ANY_VALUE(t4.`_f13`.max), ANY_VALUE(t4.`_f13`.quartiles), ANY_VALUE(t4.`_f13`.roundMin), ANY_VALUE(t4.`_f13`.roundMax), ANY_VALUE(t4.`_f13`.numBins), APPROX_TOP_COUNT(LEAST(GREATEST(0, SAFE_SUBTRACT(RANGE_BUCKET(t8.`_f11`, t4.`_f13`.buckets), 1)), SAFE_SUBTRACT(t4.`_f13`.numBins, 1)), 20)) AS date, FORMAT_NUMERICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f14`.min), ANY_VALUE(t4.`_f14`.max), ANY_VALUE(t4.`_f14`.quartiles), ANY_VALUE(t4.`_f14`.roundMin), ANY_VALUE(t4.`_f14`.roundMax), ANY_VALUE(t4.`_f14`.numBins), APPROX_TOP_COUNT(LEAST(GREATEST(0, SAFE_SUBTRACT(RANGE_BUCKET(t8.`_f12`, t4.`_f14`.buckets), 1)), SAFE_SUBTRACT(t4.`_f14`.numBins, 1)), 20)) AS visitId, FORMAT_CATEGORICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f31`), 20) AS unique_session_id, FORMAT_CATEGORICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f32`), 20) AS type, FORMAT_CATEGORICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f33`), 20) AS productRefundAmount, FORMAT_NUMERICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f16`.min), ANY_VALUE(t4.`_f16`.max), ANY_VALUE(t4.`_f16`.quartiles), ANY_VALUE(t4.`_f16`.roundMin), ANY_VALUE(t4.`_f16`.roundMax), ANY_VALUE(t4.`_f16`.numBins), APPROX_TOP_COUNT(LEAST(GREATEST(0, SAFE_SUBTRACT(RANGE_BUCKET(t8.`_f16`, t4.`_f16`.buckets), 1)), SAFE_SUBTRACT(t4.`_f16`.numBins, 1)), 20)) AS productQuantity, FORMAT_NUMERICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f17`.min), ANY_VALUE(t4.`_f17`.max), ANY_VALUE(t4.`_f17`.quartiles), ANY_VALUE(t4.`_f17`.roundMin), ANY_VALUE(t4.`_f17`.roundMax), ANY_VALUE(t4.`_f17`.numBins), APPROX_TOP_COUNT(LEAST(GREATEST(0, SAFE_SUBTRACT(RANGE_BUCKET(t8.`_f17`, t4.`_f17`.buckets), 1)), SAFE_SUBTRACT(t4.`_f17`.numBins, 1)), 20)) AS productPrice, FORMAT_CATEGORICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f40`), 20) AS productRevenue, FORMAT_CATEGORICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f41`), 20) AS productSKU, FORMAT_CATEGORICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f42`), 20) AS v2ProductName, FORMAT_CATEGORICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f43`), 20) AS v2ProductCategory, FORMAT_CATEGORICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f44`), 20) AS productVariant, FORMAT_CATEGORICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f45`), 20) AS currencyCode, FORMAT_CATEGORICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f46`), 20) AS transactionRevenue, FORMAT_CATEGORICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f47`), 20) AS transactionId, FORMAT_CATEGORICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f48`), 20) AS pageTitle, FORMAT_CATEGORICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f49`), 20) AS searchKeyword, FORMAT_CATEGORICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f50`), 20) AS pagePathLevel1, FORMAT_NUMERICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f29`.min), ANY_VALUE(t4.`_f29`.max), ANY_VALUE(t4.`_f29`.quartiles), ANY_VALUE(t4.`_f29`.roundMin), ANY_VALUE(t4.`_f29`.roundMax), ANY_VALUE(t4.`_f29`.numBins), APPROX_TOP_COUNT(LEAST(GREATEST(0, SAFE_SUBTRACT(RANGE_BUCKET(t8.`_f29`, t4.`_f29`.buckets), 1)), SAFE_SUBTRACT(t4.`_f29`.numBins, 1)), 20)) AS eCommerceAction_type, FORMAT_CATEGORICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f54`), 20) AS eCommerceAction_label, FORMAT_NUMERICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f34`.min), ANY_VALUE(t4.`_f34`.max), ANY_VALUE(t4.`_f34`.quartiles), ANY_VALUE(t4.`_f34`.roundMin), ANY_VALUE(t4.`_f34`.roundMax), ANY_VALUE(t4.`_f34`.numBins), APPROX_TOP_COUNT(LEAST(GREATEST(0, SAFE_SUBTRACT(RANGE_BUCKET(t8.`_f31`, t4.`_f34`.buckets), 1)), SAFE_SUBTRACT(t4.`_f34`.numBins, 1)), 20)) AS eCommerceAction_step, FORMAT_CATEGORICAL_PROFILE_RESULTS(ANY_VALUE(t4.`_f58`), 20) AS eCommerceAction_option
FROM (SELECT APPROX_TOP_COUNT(`_f0`, 21) AS `_f0`, APPROX_TOP_COUNT(`_f1`, 21) AS `_f1`, COMPUTE_BUCKET_INFO(MIN(SAFE_CAST(`_f2` AS FLOAT64)), MAX(SAFE_CAST(`_f2` AS FLOAT64)), APPROX_QUANTILES(SAFE_CAST(`_f2` AS FLOAT64), 4), 20) AS `_f2`, APPROX_TOP_COUNT(`_f3`, 21) AS `_f5`, APPROX_TOP_COUNT(`_f4`, 21) AS `_f6`, COMPUTE_BUCKET_INFO(MIN(SAFE_CAST(`_f5` AS FLOAT64)), MAX(SAFE_CAST(`_f5` AS FLOAT64)), APPROX_QUANTILES(SAFE_CAST(`_f5` AS FLOAT64), 4), 20) AS `_f7`, COMPUTE_BUCKET_INFO(MIN(SAFE_CAST(`_f6` AS FLOAT64)), MAX(SAFE_CAST(`_f6` AS FLOAT64)), APPROX_QUANTILES(SAFE_CAST(`_f6` AS FLOAT64), 4), 20) AS `_f8`, COMPUTE_BUCKET_INFO(MIN(SAFE_CAST(`_f7` AS FLOAT64)), MAX(SAFE_CAST(`_f7` AS FLOAT64)), APPROX_QUANTILES(SAFE_CAST(`_f7` AS FLOAT64), 4), 20) AS `_f9`, COMPUTE_BUCKET_INFO(MIN(SAFE_CAST(`_f8` AS FLOAT64)), MAX(SAFE_CAST(`_f8` AS FLOAT64)), APPROX_QUANTILES(SAFE_CAST(`_f8` AS FLOAT64), 4), 20) AS `_f10`, COMPUTE_BUCKET_INFO(MIN(SAFE_CAST(`_f9` AS FLOAT64)), MAX(SAFE_CAST(`_f9` AS FLOAT64)), APPROX_QUANTILES(SAFE_CAST(`_f9` AS FLOAT64), 4), 20) AS `_f11`, COMPUTE_BUCKET_INFO(MIN(SAFE_CAST(`_f10` AS FLOAT64)), MAX(SAFE_CAST(`_f10` AS FLOAT64)), APPROX_QUANTILES(SAFE_CAST(`_f10` AS FLOAT64), 4), 20) AS `_f12`, COMPUTE_BUCKET_INFO(MIN(SAFE_CAST(`_f11` AS FLOAT64)), MAX(SAFE_CAST(`_f11` AS FLOAT64)), APPROX_QUANTILES(SAFE_CAST(`_f11` AS FLOAT64), 4), 20) AS `_f13`, COMPUTE_BUCKET_INFO(MIN(SAFE_CAST(`_f12` AS FLOAT64)), MAX(SAFE_CAST(`_f12` AS FLOAT64)), APPROX_QUANTILES(SAFE_CAST(`_f12` AS FLOAT64), 4), 20) AS `_f14`, APPROX_TOP_COUNT(`_f13`, 21) AS `_f31`, APPROX_TOP_COUNT(`_f14`, 21) AS `_f32`, APPROX_TOP_COUNT(`_f15`, 21) AS `_f33`, COMPUTE_BUCKET_INFO(MIN(SAFE_CAST(`_f16` AS FLOAT64)), MAX(SAFE_CAST(`_f16` AS FLOAT64)), APPROX_QUANTILES(SAFE_CAST(`_f16` AS FLOAT64), 4), 20) AS `_f16`, COMPUTE_BUCKET_INFO(MIN(SAFE_CAST(`_f17` AS FLOAT64)), MAX(SAFE_CAST(`_f17` AS FLOAT64)), APPROX_QUANTILES(SAFE_CAST(`_f17` AS FLOAT64), 4), 20) AS `_f17`, APPROX_TOP_COUNT(`_f18`, 21) AS `_f40`, APPROX_TOP_COUNT(`_f19`, 21) AS `_f41`, APPROX_TOP_COUNT(`_f20`, 21) AS `_f42`, APPROX_TOP_COUNT(`_f21`, 21) AS `_f43`, APPROX_TOP_COUNT(`_f22`, 21) AS `_f44`, APPROX_TOP_COUNT(`_f23`, 21) AS `_f45`, APPROX_TOP_COUNT(`_f24`, 21) AS `_f46`, APPROX_TOP_COUNT(`_f25`, 21) AS `_f47`, APPROX_TOP_COUNT(`_f26`, 21) AS `_f48`, APPROX_TOP_COUNT(`_f27`, 21) AS `_f49`, APPROX_TOP_COUNT(`_f28`, 21) AS `_f50`, COMPUTE_BUCKET_INFO(MIN(SAFE_CAST(`_f29` AS FLOAT64)), MAX(SAFE_CAST(`_f29` AS FLOAT64)), APPROX_QUANTILES(SAFE_CAST(`_f29` AS FLOAT64), 4), 20) AS `_f29`, APPROX_TOP_COUNT(`_f30`, 21) AS `_f54`, COMPUTE_BUCKET_INFO(MIN(SAFE_CAST(`_f31` AS FLOAT64)), MAX(SAFE_CAST(`_f31` AS FLOAT64)), APPROX_QUANTILES(SAFE_CAST(`_f31` AS FLOAT64), 4), 20) AS `_f34`, APPROX_TOP_COUNT(`_f32`, 21) AS `_f58`, 1 AS `_f35`
  FROM (SELECT (CASE WHEN ((CASE WHEN ((fullVisitorId_temp_ IS NOT NULL) AND (fullVisitorId_temp_ <> '')) THEN 'VALID' WHEN ((fullVisitorId_temp_ IS NULL) OR (fullVisitorId_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN fullVisitorId_temp_ ELSE NULL END) AS `_f0`, (CASE WHEN ((CASE WHEN ((channelGrouping_temp_ IS NOT NULL) AND (channelGrouping_temp_ <> '')) THEN 'VALID' WHEN ((channelGrouping_temp_ IS NULL) OR (channelGrouping_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN channelGrouping_temp_ ELSE NULL END) AS `_f1`, (CASE WHEN ((CASE WHEN (time_temp_ IS NOT NULL) THEN 'VALID' WHEN (time_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN time_temp_ ELSE NULL END) AS `_f2`, (CASE WHEN ((CASE WHEN ((country_temp_ IS NOT NULL) AND (country_temp_ <> '')) THEN 'VALID' WHEN ((country_temp_ IS NULL) OR (country_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN country_temp_ ELSE NULL END) AS `_f3`, (CASE WHEN ((CASE WHEN ((city_temp_ IS NOT NULL) AND (city_temp_ <> '')) THEN 'VALID' WHEN ((city_temp_ IS NULL) OR (city_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN city_temp_ ELSE NULL END) AS `_f4`, (CASE WHEN ((CASE WHEN (totalTransactionRevenue_temp_ IS NOT NULL) THEN 'VALID' WHEN (totalTransactionRevenue_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN totalTransactionRevenue_temp_ ELSE NULL END) AS `_f5`, (CASE WHEN ((CASE WHEN (`_f6_temp_` IS NOT NULL) THEN 'VALID' WHEN (`_f6_temp_` IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN `_f6_temp_` ELSE NULL END) AS `_f6`, (CASE WHEN ((CASE WHEN (transactions_temp_ IS NOT NULL) THEN 'VALID' WHEN (transactions_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN transactions_temp_ ELSE NULL END) AS `_f7`, (CASE WHEN ((CASE WHEN (timeOnSite_temp_ IS NOT NULL) THEN 'VALID' WHEN (timeOnSite_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN timeOnSite_temp_ ELSE NULL END) AS `_f8`, (CASE WHEN ((CASE WHEN (pageviews_temp_ IS NOT NULL) THEN 'VALID' WHEN (pageviews_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN pageviews_temp_ ELSE NULL END) AS `_f9`, (CASE WHEN ((CASE WHEN (sessionQualityDim_temp_ IS NOT NULL) THEN 'VALID' WHEN (sessionQualityDim_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN sessionQualityDim_temp_ ELSE NULL END) AS `_f10`, UNIX_MILLIS((CASE WHEN ((CASE WHEN IFNULL(REGEXP_CONTAINS(LOWER(REGEXP_REPLACE(date_temp_, r'^\s+|\s+$', '')), r'^((?:1[4-9]|2[0-5])\d{2})(0?[1-9]|1[0-2])([0-2][0-9]|30|31)$'), FALSE) THEN 'VALID' WHEN ((date_temp_ IS NULL) OR (date_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN SAFE.PARSE_TIMESTAMP('%Y %m %e', REGEXP_REPLACE(TRIM(date_temp_), r'(?i)(?:^((?:1[4-9]|2[0-5])\d{2})(0?[1-9]|1[0-2])([0-2][0-9]|30|31)$)|(?:^.*$)', r'\1 \2 \3')) ELSE SAFE.PARSE_TIMESTAMP('%Y %m %e', REGEXP_REPLACE(TRIM(NULL), r'(?i)(?:^((?:1[4-9]|2[0-5])\d{2})(0?[1-9]|1[0-2])([0-2][0-9]|30|31)$)|(?:^.*$)', r'\1 \2 \3')) END)) AS `_f11`, (CASE WHEN ((CASE WHEN (visitId_temp_ IS NOT NULL) THEN 'VALID' WHEN (visitId_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN visitId_temp_ ELSE NULL END) AS `_f12`, (CASE WHEN ((CASE WHEN ((`_f12_temp_` IS NOT NULL) AND (`_f12_temp_` <> '')) THEN 'VALID' WHEN ((`_f12_temp_` IS NULL) OR (`_f12_temp_` = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN `_f12_temp_` ELSE NULL END) AS `_f13`, (CASE WHEN ((CASE WHEN ((type_temp_ IS NOT NULL) AND (type_temp_ <> '')) THEN 'VALID' WHEN ((type_temp_ IS NULL) OR (type_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN type_temp_ ELSE NULL END) AS `_f14`, (CASE WHEN ((CASE WHEN ((CAST(productRefundAmount_temp_ AS STRING) IS NOT NULL) AND (CAST(productRefundAmount_temp_ AS STRING) <> '')) THEN 'VALID' WHEN (productRefundAmount_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN CAST(productRefundAmount_temp_ AS STRING) ELSE NULL END) AS `_f15`, (CASE WHEN ((CASE WHEN (productQuantity_temp_ IS NOT NULL) THEN 'VALID' WHEN (productQuantity_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN productQuantity_temp_ ELSE NULL END) AS `_f16`, (CASE WHEN ((CASE WHEN (productPrice_temp_ IS NOT NULL) THEN 'VALID' WHEN (productPrice_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN productPrice_temp_ ELSE NULL END) AS `_f17`, (CASE WHEN ((CASE WHEN ((CAST(productRevenue_temp_ AS STRING) IS NOT NULL) AND (CAST(productRevenue_temp_ AS STRING) <> '')) THEN 'VALID' WHEN (productRevenue_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN CAST(productRevenue_temp_ AS STRING) ELSE NULL END) AS `_f18`, (CASE WHEN ((CASE WHEN ((productSKU_temp_ IS NOT NULL) AND (productSKU_temp_ <> '')) THEN 'VALID' WHEN ((productSKU_temp_ IS NULL) OR (productSKU_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN productSKU_temp_ ELSE NULL END) AS `_f19`, (CASE WHEN ((CASE WHEN ((v2ProductName_temp_ IS NOT NULL) AND (v2ProductName_temp_ <> '')) THEN 'VALID' WHEN ((v2ProductName_temp_ IS NULL) OR (v2ProductName_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN v2ProductName_temp_ ELSE NULL END) AS `_f20`, (CASE WHEN ((CASE WHEN ((v2ProductCategory_temp_ IS NOT NULL) AND (v2ProductCategory_temp_ <> '')) THEN 'VALID' WHEN ((v2ProductCategory_temp_ IS NULL) OR (v2ProductCategory_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN v2ProductCategory_temp_ ELSE NULL END) AS `_f21`, (CASE WHEN ((CASE WHEN ((productVariant_temp_ IS NOT NULL) AND (productVariant_temp_ <> '')) THEN 'VALID' WHEN ((productVariant_temp_ IS NULL) OR (productVariant_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN productVariant_temp_ ELSE NULL END) AS `_f22`, (CASE WHEN ((CASE WHEN ((currencyCode_temp_ IS NOT NULL) AND (currencyCode_temp_ <> '')) THEN 'VALID' WHEN ((currencyCode_temp_ IS NULL) OR (currencyCode_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN currencyCode_temp_ ELSE NULL END) AS `_f23`, (CASE WHEN ((CASE WHEN ((CAST(transactionRevenue_temp_ AS STRING) IS NOT NULL) AND (CAST(transactionRevenue_temp_ AS STRING) <> '')) THEN 'VALID' WHEN (transactionRevenue_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN CAST(transactionRevenue_temp_ AS STRING) ELSE NULL END) AS `_f24`, (CASE WHEN ((CASE WHEN ((transactionId_temp_ IS NOT NULL) AND (transactionId_temp_ <> '')) THEN 'VALID' WHEN ((transactionId_temp_ IS NULL) OR (transactionId_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN transactionId_temp_ ELSE NULL END) AS `_f25`, (CASE WHEN ((CASE WHEN ((pageTitle_temp_ IS NOT NULL) AND (pageTitle_temp_ <> '')) THEN 'VALID' WHEN ((pageTitle_temp_ IS NULL) OR (pageTitle_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN pageTitle_temp_ ELSE NULL END) AS `_f26`, (CASE WHEN ((CASE WHEN ((searchKeyword_temp_ IS NOT NULL) AND (searchKeyword_temp_ <> '')) THEN 'VALID' WHEN ((searchKeyword_temp_ IS NULL) OR (searchKeyword_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN searchKeyword_temp_ ELSE NULL END) AS `_f27`, (CASE WHEN ((CASE WHEN ((pagePathLevel1_temp_ IS NOT NULL) AND (pagePathLevel1_temp_ <> '')) THEN 'VALID' WHEN ((pagePathLevel1_temp_ IS NULL) OR (pagePathLevel1_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN pagePathLevel1_temp_ ELSE NULL END) AS `_f28`, (CASE WHEN ((CASE WHEN (SAFE_CAST(eCommerceAction_type_temp_ AS INT64) IS NOT NULL) THEN 'VALID' WHEN ((eCommerceAction_type_temp_ IS NULL) OR (eCommerceAction_type_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN SAFE_CAST(eCommerceAction_type_temp_ AS INT64) ELSE NULL END) AS `_f29`, (CASE WHEN ((CASE WHEN ((`_f29_temp_` IS NOT NULL) AND (`_f29_temp_` <> '')) THEN 'VALID' WHEN ((`_f29_temp_` IS NULL) OR (`_f29_temp_` = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN `_f29_temp_` ELSE NULL END) AS `_f30`, (CASE WHEN ((CASE WHEN (eCommerceAction_step_temp_ IS NOT NULL) THEN 'VALID' WHEN (eCommerceAction_step_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN eCommerceAction_step_temp_ ELSE NULL END) AS `_f31`, (CASE WHEN ((CASE WHEN ((eCommerceAction_option_temp_ IS NOT NULL) AND (eCommerceAction_option_temp_ <> '')) THEN 'VALID' WHEN ((eCommerceAction_option_temp_ IS NULL) OR (eCommerceAction_option_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN eCommerceAction_option_temp_ ELSE NULL END) AS `_f32`
    FROM `_SESSION`.TF_TEMP_TBL) AS t1) AS t4
 INNER JOIN (SELECT (CASE WHEN ((CASE WHEN ((fullVisitorId_temp_ IS NOT NULL) AND (fullVisitorId_temp_ <> '')) THEN 'VALID' WHEN ((fullVisitorId_temp_ IS NULL) OR (fullVisitorId_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN fullVisitorId_temp_ ELSE NULL END) AS `_f0`, (CASE WHEN ((CASE WHEN ((channelGrouping_temp_ IS NOT NULL) AND (channelGrouping_temp_ <> '')) THEN 'VALID' WHEN ((channelGrouping_temp_ IS NULL) OR (channelGrouping_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN channelGrouping_temp_ ELSE NULL END) AS `_f1`, (CASE WHEN ((CASE WHEN (time_temp_ IS NOT NULL) THEN 'VALID' WHEN (time_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN time_temp_ ELSE NULL END) AS `_f2`, (CASE WHEN ((CASE WHEN ((country_temp_ IS NOT NULL) AND (country_temp_ <> '')) THEN 'VALID' WHEN ((country_temp_ IS NULL) OR (country_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN country_temp_ ELSE NULL END) AS `_f3`, (CASE WHEN ((CASE WHEN ((city_temp_ IS NOT NULL) AND (city_temp_ <> '')) THEN 'VALID' WHEN ((city_temp_ IS NULL) OR (city_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN city_temp_ ELSE NULL END) AS `_f4`, (CASE WHEN ((CASE WHEN (totalTransactionRevenue_temp_ IS NOT NULL) THEN 'VALID' WHEN (totalTransactionRevenue_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN totalTransactionRevenue_temp_ ELSE NULL END) AS `_f5`, (CASE WHEN ((CASE WHEN (`_f6_temp_` IS NOT NULL) THEN 'VALID' WHEN (`_f6_temp_` IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN `_f6_temp_` ELSE NULL END) AS `_f6`, (CASE WHEN ((CASE WHEN (transactions_temp_ IS NOT NULL) THEN 'VALID' WHEN (transactions_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN transactions_temp_ ELSE NULL END) AS `_f7`, (CASE WHEN ((CASE WHEN (timeOnSite_temp_ IS NOT NULL) THEN 'VALID' WHEN (timeOnSite_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN timeOnSite_temp_ ELSE NULL END) AS `_f8`, (CASE WHEN ((CASE WHEN (pageviews_temp_ IS NOT NULL) THEN 'VALID' WHEN (pageviews_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN pageviews_temp_ ELSE NULL END) AS `_f9`, (CASE WHEN ((CASE WHEN (sessionQualityDim_temp_ IS NOT NULL) THEN 'VALID' WHEN (sessionQualityDim_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN sessionQualityDim_temp_ ELSE NULL END) AS `_f10`, UNIX_MILLIS((CASE WHEN ((CASE WHEN IFNULL(REGEXP_CONTAINS(LOWER(REGEXP_REPLACE(date_temp_, r'^\s+|\s+$', '')), r'^((?:1[4-9]|2[0-5])\d{2})(0?[1-9]|1[0-2])([0-2][0-9]|30|31)$'), FALSE) THEN 'VALID' WHEN ((date_temp_ IS NULL) OR (date_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN SAFE.PARSE_TIMESTAMP('%Y %m %e', REGEXP_REPLACE(TRIM(date_temp_), r'(?i)(?:^((?:1[4-9]|2[0-5])\d{2})(0?[1-9]|1[0-2])([0-2][0-9]|30|31)$)|(?:^.*$)', r'\1 \2 \3')) ELSE SAFE.PARSE_TIMESTAMP('%Y %m %e', REGEXP_REPLACE(TRIM(NULL), r'(?i)(?:^((?:1[4-9]|2[0-5])\d{2})(0?[1-9]|1[0-2])([0-2][0-9]|30|31)$)|(?:^.*$)', r'\1 \2 \3')) END)) AS `_f11`, (CASE WHEN ((CASE WHEN (visitId_temp_ IS NOT NULL) THEN 'VALID' WHEN (visitId_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN visitId_temp_ ELSE NULL END) AS `_f12`, (CASE WHEN ((CASE WHEN ((`_f12_temp_` IS NOT NULL) AND (`_f12_temp_` <> '')) THEN 'VALID' WHEN ((`_f12_temp_` IS NULL) OR (`_f12_temp_` = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN `_f12_temp_` ELSE NULL END) AS `_f13`, (CASE WHEN ((CASE WHEN ((type_temp_ IS NOT NULL) AND (type_temp_ <> '')) THEN 'VALID' WHEN ((type_temp_ IS NULL) OR (type_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN type_temp_ ELSE NULL END) AS `_f14`, (CASE WHEN ((CASE WHEN ((CAST(productRefundAmount_temp_ AS STRING) IS NOT NULL) AND (CAST(productRefundAmount_temp_ AS STRING) <> '')) THEN 'VALID' WHEN (productRefundAmount_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN CAST(productRefundAmount_temp_ AS STRING) ELSE NULL END) AS `_f15`, (CASE WHEN ((CASE WHEN (productQuantity_temp_ IS NOT NULL) THEN 'VALID' WHEN (productQuantity_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN productQuantity_temp_ ELSE NULL END) AS `_f16`, (CASE WHEN ((CASE WHEN (productPrice_temp_ IS NOT NULL) THEN 'VALID' WHEN (productPrice_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN productPrice_temp_ ELSE NULL END) AS `_f17`, (CASE WHEN ((CASE WHEN ((CAST(productRevenue_temp_ AS STRING) IS NOT NULL) AND (CAST(productRevenue_temp_ AS STRING) <> '')) THEN 'VALID' WHEN (productRevenue_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN CAST(productRevenue_temp_ AS STRING) ELSE NULL END) AS `_f18`, (CASE WHEN ((CASE WHEN ((productSKU_temp_ IS NOT NULL) AND (productSKU_temp_ <> '')) THEN 'VALID' WHEN ((productSKU_temp_ IS NULL) OR (productSKU_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN productSKU_temp_ ELSE NULL END) AS `_f19`, (CASE WHEN ((CASE WHEN ((v2ProductName_temp_ IS NOT NULL) AND (v2ProductName_temp_ <> '')) THEN 'VALID' WHEN ((v2ProductName_temp_ IS NULL) OR (v2ProductName_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN v2ProductName_temp_ ELSE NULL END) AS `_f20`, (CASE WHEN ((CASE WHEN ((v2ProductCategory_temp_ IS NOT NULL) AND (v2ProductCategory_temp_ <> '')) THEN 'VALID' WHEN ((v2ProductCategory_temp_ IS NULL) OR (v2ProductCategory_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN v2ProductCategory_temp_ ELSE NULL END) AS `_f21`, (CASE WHEN ((CASE WHEN ((productVariant_temp_ IS NOT NULL) AND (productVariant_temp_ <> '')) THEN 'VALID' WHEN ((productVariant_temp_ IS NULL) OR (productVariant_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN productVariant_temp_ ELSE NULL END) AS `_f22`, (CASE WHEN ((CASE WHEN ((currencyCode_temp_ IS NOT NULL) AND (currencyCode_temp_ <> '')) THEN 'VALID' WHEN ((currencyCode_temp_ IS NULL) OR (currencyCode_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN currencyCode_temp_ ELSE NULL END) AS `_f23`, (CASE WHEN ((CASE WHEN ((CAST(transactionRevenue_temp_ AS STRING) IS NOT NULL) AND (CAST(transactionRevenue_temp_ AS STRING) <> '')) THEN 'VALID' WHEN (transactionRevenue_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN CAST(transactionRevenue_temp_ AS STRING) ELSE NULL END) AS `_f24`, (CASE WHEN ((CASE WHEN ((transactionId_temp_ IS NOT NULL) AND (transactionId_temp_ <> '')) THEN 'VALID' WHEN ((transactionId_temp_ IS NULL) OR (transactionId_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN transactionId_temp_ ELSE NULL END) AS `_f25`, (CASE WHEN ((CASE WHEN ((pageTitle_temp_ IS NOT NULL) AND (pageTitle_temp_ <> '')) THEN 'VALID' WHEN ((pageTitle_temp_ IS NULL) OR (pageTitle_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN pageTitle_temp_ ELSE NULL END) AS `_f26`, (CASE WHEN ((CASE WHEN ((searchKeyword_temp_ IS NOT NULL) AND (searchKeyword_temp_ <> '')) THEN 'VALID' WHEN ((searchKeyword_temp_ IS NULL) OR (searchKeyword_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN searchKeyword_temp_ ELSE NULL END) AS `_f27`, (CASE WHEN ((CASE WHEN ((pagePathLevel1_temp_ IS NOT NULL) AND (pagePathLevel1_temp_ <> '')) THEN 'VALID' WHEN ((pagePathLevel1_temp_ IS NULL) OR (pagePathLevel1_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN pagePathLevel1_temp_ ELSE NULL END) AS `_f28`, (CASE WHEN ((CASE WHEN (SAFE_CAST(eCommerceAction_type_temp_ AS INT64) IS NOT NULL) THEN 'VALID' WHEN ((eCommerceAction_type_temp_ IS NULL) OR (eCommerceAction_type_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN SAFE_CAST(eCommerceAction_type_temp_ AS INT64) ELSE NULL END) AS `_f29`, (CASE WHEN ((CASE WHEN ((`_f29_temp_` IS NOT NULL) AND (`_f29_temp_` <> '')) THEN 'VALID' WHEN ((`_f29_temp_` IS NULL) OR (`_f29_temp_` = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN `_f29_temp_` ELSE NULL END) AS `_f30`, (CASE WHEN ((CASE WHEN (eCommerceAction_step_temp_ IS NOT NULL) THEN 'VALID' WHEN (eCommerceAction_step_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN eCommerceAction_step_temp_ ELSE NULL END) AS `_f31`, (CASE WHEN ((CASE WHEN ((eCommerceAction_option_temp_ IS NOT NULL) AND (eCommerceAction_option_temp_ <> '')) THEN 'VALID' WHEN ((eCommerceAction_option_temp_ IS NULL) OR (eCommerceAction_option_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) = 'VALID') THEN eCommerceAction_option_temp_ ELSE NULL END) AS `_f32`, 1 AS `_f33`
  FROM `_SESSION`.TF_TEMP_TBL AS TF_TEMP_TBL0) AS t8 ON (t4.`_f35` = t8.`_f33`);
CREATE OR REPLACE TABLE `qwiklabs-gcp-01-ce890c4f7559.ecommerce.revenue_reporting` AS SELECT fullVisitorId_temp_ AS fullVisitorId, channelGrouping_temp_ AS channelGrouping, time_temp_ AS time, country_temp_ AS country, city_temp_ AS city, totalTransactionRevenue_temp_ AS totalTransactionRevenue, `_f6_temp_` AS totalTransactionRevenue1, transactions_temp_ AS transactions, timeOnSite_temp_ AS timeOnSite, pageviews_temp_ AS pageviews, sessionQualityDim_temp_ AS sessionQualityDim, DATETIME((CASE WHEN IFNULL(REGEXP_CONTAINS(LOWER(REGEXP_REPLACE(date_temp_, r'^\s+|\s+$', '')), r'^((?:1[4-9]|2[0-5])\d{2})(0?[1-9]|1[0-2])([0-2][0-9]|30|31)$'), FALSE) THEN SAFE.PARSE_TIMESTAMP('%Y %m %e', REGEXP_REPLACE(TRIM(date_temp_), r'(?i)(?:^((?:1[4-9]|2[0-5])\d{2})(0?[1-9]|1[0-2])([0-2][0-9]|30|31)$)|(?:^.*$)', r'\1 \2 \3')) ELSE SAFE.PARSE_TIMESTAMP('%Y %m %e', REGEXP_REPLACE(TRIM(NULL), r'(?i)(?:^((?:1[4-9]|2[0-5])\d{2})(0?[1-9]|1[0-2])([0-2][0-9]|30|31)$)|(?:^.*$)', r'\1 \2 \3')) END)) AS date, visitId_temp_ AS visitId, `_f12_temp_` AS unique_session_id, type_temp_ AS type, CAST(productRefundAmount_temp_ AS STRING) AS productRefundAmount, productQuantity_temp_ AS productQuantity, productPrice_temp_ AS productPrice, CAST(productRevenue_temp_ AS STRING) AS productRevenue, productSKU_temp_ AS productSKU, v2ProductName_temp_ AS v2ProductName, v2ProductCategory_temp_ AS v2ProductCategory, productVariant_temp_ AS productVariant, currencyCode_temp_ AS currencyCode, CAST(transactionRevenue_temp_ AS STRING) AS transactionRevenue, transactionId_temp_ AS transactionId, pageTitle_temp_ AS pageTitle, searchKeyword_temp_ AS searchKeyword, pagePathLevel1_temp_ AS pagePathLevel1, SAFE_CAST(eCommerceAction_type_temp_ AS INT64) AS eCommerceAction_type, `_f29_temp_` AS eCommerceAction_label, eCommerceAction_step_temp_ AS eCommerceAction_step, eCommerceAction_option_temp_ AS eCommerceAction_option
FROM `_SESSION`.TF_TEMP_TBL;
EXPORT DATA OPTIONS(
  uri='gs://dataprep-staging-42666461-a1a6-4c75-876e-19c764660b2f/student-02-cacb906211b4@qwiklabs.net/jobrun/all_sessions_raw_dataprep_17012301/.profiler_3f608612-f2e9-4bfc-891c-acff5c3cf3f1/profilerTypeCheckHistograms.json/*',
  format='JSON',
  overwrite=true
) AS SELECT FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f33` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f33` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f33` = 'EMPTY')) AS NUMERIC) AS count)])) AS fullVisitorId, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f34` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f34` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f34` = 'EMPTY')) AS NUMERIC) AS count)])) AS channelGrouping, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f35` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f35` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f35` = 'EMPTY')) AS NUMERIC) AS count)])) AS time, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f36` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f36` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f36` = 'EMPTY')) AS NUMERIC) AS count)])) AS country, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f37` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f37` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f37` = 'EMPTY')) AS NUMERIC) AS count)])) AS city, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f38` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f38` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f38` = 'EMPTY')) AS NUMERIC) AS count)])) AS totalTransactionRevenue, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f39` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f39` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f39` = 'EMPTY')) AS NUMERIC) AS count)])) AS totalTransactionRevenue1, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f40` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f40` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f40` = 'EMPTY')) AS NUMERIC) AS count)])) AS transactions, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f41` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f41` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f41` = 'EMPTY')) AS NUMERIC) AS count)])) AS timeOnSite, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f42` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f42` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f42` = 'EMPTY')) AS NUMERIC) AS count)])) AS pageviews, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f43` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f43` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f43` = 'EMPTY')) AS NUMERIC) AS count)])) AS sessionQualityDim, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f44` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f44` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f44` = 'EMPTY')) AS NUMERIC) AS count)])) AS date, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f45` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f45` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f45` = 'EMPTY')) AS NUMERIC) AS count)])) AS visitId, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f46` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f46` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f46` = 'EMPTY')) AS NUMERIC) AS count)])) AS unique_session_id, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f47` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f47` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f47` = 'EMPTY')) AS NUMERIC) AS count)])) AS type, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f48` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f48` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f48` = 'EMPTY')) AS NUMERIC) AS count)])) AS productRefundAmount, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f49` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f49` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f49` = 'EMPTY')) AS NUMERIC) AS count)])) AS productQuantity, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f50` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f50` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f50` = 'EMPTY')) AS NUMERIC) AS count)])) AS productPrice, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f51` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f51` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f51` = 'EMPTY')) AS NUMERIC) AS count)])) AS productRevenue, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f52` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f52` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f52` = 'EMPTY')) AS NUMERIC) AS count)])) AS productSKU, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f53` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f53` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f53` = 'EMPTY')) AS NUMERIC) AS count)])) AS v2ProductName, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f54` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f54` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f54` = 'EMPTY')) AS NUMERIC) AS count)])) AS v2ProductCategory, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f55` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f55` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f55` = 'EMPTY')) AS NUMERIC) AS count)])) AS productVariant, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f56` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f56` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f56` = 'EMPTY')) AS NUMERIC) AS count)])) AS currencyCode, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f57` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f57` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f57` = 'EMPTY')) AS NUMERIC) AS count)])) AS transactionRevenue, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f58` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f58` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f58` = 'EMPTY')) AS NUMERIC) AS count)])) AS transactionId, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f59` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f59` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f59` = 'EMPTY')) AS NUMERIC) AS count)])) AS pageTitle, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f60` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f60` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f60` = 'EMPTY')) AS NUMERIC) AS count)])) AS searchKeyword, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f61` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f61` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f61` = 'EMPTY')) AS NUMERIC) AS count)])) AS pagePathLevel1, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f62` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f62` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f62` = 'EMPTY')) AS NUMERIC) AS count)])) AS eCommerceAction_type, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f63` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f63` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f63` = 'EMPTY')) AS NUMERIC) AS count)])) AS eCommerceAction_label, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f64` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f64` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f64` = 'EMPTY')) AS NUMERIC) AS count)])) AS eCommerceAction_step, FORMAT_TYPE_CHECK_PROFILE_RESULTS(([STRUCT('VALID' AS key, SAFE_CAST(COUNTIF((`_f65` = 'VALID')) AS NUMERIC) AS count), STRUCT('INVALID' AS key, SAFE_CAST(COUNTIF((`_f65` = 'INVALID')) AS NUMERIC) AS count), STRUCT('EMPTY' AS key, SAFE_CAST(COUNTIF((`_f65` = 'EMPTY')) AS NUMERIC) AS count)])) AS eCommerceAction_option
FROM (SELECT fullVisitorId_temp_, channelGrouping_temp_, time_temp_, country_temp_, city_temp_, totalTransactionRevenue_temp_, `_f6_temp_`, transactions_temp_, timeOnSite_temp_, pageviews_temp_, sessionQualityDim_temp_, date_temp_, visitId_temp_, `_f12_temp_`, type_temp_, productRefundAmount_temp_, productQuantity_temp_, productPrice_temp_, productRevenue_temp_, productSKU_temp_, v2ProductName_temp_, v2ProductCategory_temp_, productVariant_temp_, currencyCode_temp_, transactionRevenue_temp_, transactionId_temp_, pageTitle_temp_, searchKeyword_temp_, pagePathLevel1_temp_, eCommerceAction_type_temp_, `_f29_temp_`, eCommerceAction_step_temp_, eCommerceAction_option_temp_, (CASE WHEN ((fullVisitorId_temp_ IS NOT NULL) AND (fullVisitorId_temp_ <> '')) THEN 'VALID' WHEN ((fullVisitorId_temp_ IS NULL) OR (fullVisitorId_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f33`, (CASE WHEN ((channelGrouping_temp_ IS NOT NULL) AND (channelGrouping_temp_ <> '')) THEN 'VALID' WHEN ((channelGrouping_temp_ IS NULL) OR (channelGrouping_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f34`, (CASE WHEN (time_temp_ IS NOT NULL) THEN 'VALID' WHEN (time_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f35`, (CASE WHEN ((country_temp_ IS NOT NULL) AND (country_temp_ <> '')) THEN 'VALID' WHEN ((country_temp_ IS NULL) OR (country_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f36`, (CASE WHEN ((city_temp_ IS NOT NULL) AND (city_temp_ <> '')) THEN 'VALID' WHEN ((city_temp_ IS NULL) OR (city_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f37`, (CASE WHEN (totalTransactionRevenue_temp_ IS NOT NULL) THEN 'VALID' WHEN (totalTransactionRevenue_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f38`, (CASE WHEN (`_f6_temp_` IS NOT NULL) THEN 'VALID' WHEN (`_f6_temp_` IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f39`, (CASE WHEN (transactions_temp_ IS NOT NULL) THEN 'VALID' WHEN (transactions_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f40`, (CASE WHEN (timeOnSite_temp_ IS NOT NULL) THEN 'VALID' WHEN (timeOnSite_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f41`, (CASE WHEN (pageviews_temp_ IS NOT NULL) THEN 'VALID' WHEN (pageviews_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f42`, (CASE WHEN (sessionQualityDim_temp_ IS NOT NULL) THEN 'VALID' WHEN (sessionQualityDim_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f43`, (CASE WHEN IFNULL(REGEXP_CONTAINS(LOWER(REGEXP_REPLACE(date_temp_, r'^\s+|\s+$', '')), r'^((?:1[4-9]|2[0-5])\d{2})(0?[1-9]|1[0-2])([0-2][0-9]|30|31)$'), FALSE) THEN 'VALID' WHEN ((date_temp_ IS NULL) OR (date_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f44`, (CASE WHEN (visitId_temp_ IS NOT NULL) THEN 'VALID' WHEN (visitId_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f45`, (CASE WHEN ((`_f12_temp_` IS NOT NULL) AND (`_f12_temp_` <> '')) THEN 'VALID' WHEN ((`_f12_temp_` IS NULL) OR (`_f12_temp_` = '')) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f46`, (CASE WHEN ((type_temp_ IS NOT NULL) AND (type_temp_ <> '')) THEN 'VALID' WHEN ((type_temp_ IS NULL) OR (type_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f47`, (CASE WHEN ((CAST(productRefundAmount_temp_ AS STRING) IS NOT NULL) AND (CAST(productRefundAmount_temp_ AS STRING) <> '')) THEN 'VALID' WHEN (productRefundAmount_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f48`, (CASE WHEN (productQuantity_temp_ IS NOT NULL) THEN 'VALID' WHEN (productQuantity_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f49`, (CASE WHEN (productPrice_temp_ IS NOT NULL) THEN 'VALID' WHEN (productPrice_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f50`, (CASE WHEN ((CAST(productRevenue_temp_ AS STRING) IS NOT NULL) AND (CAST(productRevenue_temp_ AS STRING) <> '')) THEN 'VALID' WHEN (productRevenue_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f51`, (CASE WHEN ((productSKU_temp_ IS NOT NULL) AND (productSKU_temp_ <> '')) THEN 'VALID' WHEN ((productSKU_temp_ IS NULL) OR (productSKU_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f52`, (CASE WHEN ((v2ProductName_temp_ IS NOT NULL) AND (v2ProductName_temp_ <> '')) THEN 'VALID' WHEN ((v2ProductName_temp_ IS NULL) OR (v2ProductName_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f53`, (CASE WHEN ((v2ProductCategory_temp_ IS NOT NULL) AND (v2ProductCategory_temp_ <> '')) THEN 'VALID' WHEN ((v2ProductCategory_temp_ IS NULL) OR (v2ProductCategory_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f54`, (CASE WHEN ((productVariant_temp_ IS NOT NULL) AND (productVariant_temp_ <> '')) THEN 'VALID' WHEN ((productVariant_temp_ IS NULL) OR (productVariant_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f55`, (CASE WHEN ((currencyCode_temp_ IS NOT NULL) AND (currencyCode_temp_ <> '')) THEN 'VALID' WHEN ((currencyCode_temp_ IS NULL) OR (currencyCode_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f56`, (CASE WHEN ((CAST(transactionRevenue_temp_ AS STRING) IS NOT NULL) AND (CAST(transactionRevenue_temp_ AS STRING) <> '')) THEN 'VALID' WHEN (transactionRevenue_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f57`, (CASE WHEN ((transactionId_temp_ IS NOT NULL) AND (transactionId_temp_ <> '')) THEN 'VALID' WHEN ((transactionId_temp_ IS NULL) OR (transactionId_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f58`, (CASE WHEN ((pageTitle_temp_ IS NOT NULL) AND (pageTitle_temp_ <> '')) THEN 'VALID' WHEN ((pageTitle_temp_ IS NULL) OR (pageTitle_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f59`, (CASE WHEN ((searchKeyword_temp_ IS NOT NULL) AND (searchKeyword_temp_ <> '')) THEN 'VALID' WHEN ((searchKeyword_temp_ IS NULL) OR (searchKeyword_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f60`, (CASE WHEN ((pagePathLevel1_temp_ IS NOT NULL) AND (pagePathLevel1_temp_ <> '')) THEN 'VALID' WHEN ((pagePathLevel1_temp_ IS NULL) OR (pagePathLevel1_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f61`, (CASE WHEN (SAFE_CAST(eCommerceAction_type_temp_ AS INT64) IS NOT NULL) THEN 'VALID' WHEN ((eCommerceAction_type_temp_ IS NULL) OR (eCommerceAction_type_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f62`, (CASE WHEN ((`_f29_temp_` IS NOT NULL) AND (`_f29_temp_` <> '')) THEN 'VALID' WHEN ((`_f29_temp_` IS NULL) OR (`_f29_temp_` = '')) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f63`, (CASE WHEN (eCommerceAction_step_temp_ IS NOT NULL) THEN 'VALID' WHEN (eCommerceAction_step_temp_ IS NULL) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f64`, (CASE WHEN ((eCommerceAction_option_temp_ IS NOT NULL) AND (eCommerceAction_option_temp_ <> '')) THEN 'VALID' WHEN ((eCommerceAction_option_temp_ IS NULL) OR (eCommerceAction_option_temp_ = '')) THEN 'EMPTY' ELSE 'INVALID' END) AS `_f65`
  FROM `_SESSION`.TF_TEMP_TBL) AS t
